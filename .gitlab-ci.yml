
variables:
  VERSION: 1.0.$CI_PIPELINE_ID

  EVENT_BUS_CLIENT_BRANCH: patrick_modifications
  EVENT_BUS_CLIENT_VERSION: 1.0.113

stages:
  - get_dependencies
  - test
  - build
  - release

fetch_client_lib:
  stage: get_dependencies
  image: appropriate/curl
  script:
    - "curl -f -L -H \"PRIVATE-TOKEN: $SECRET_APIKEY\" -o include/eventbusclient-$EVENT_BUS_CLIENT_VERSION.jar \"http://sed-team-project/SED-DEV-group/event-bus-client-lib/builds/artifacts/$EVENT_BUS_CLIENT_BRANCH/raw/target/eventbusclient-$EVENT_BUS_CLIENT_VERSION.jar?job=build\""

test:
  stage: test
  image: maven:3-jdk-8
  script:
    - mvn test

build:
  stage: build
  image: maven:3-jdk-8
  script:
    - mvn versions:set -DnewVersion=$VERSION
    - mvn clean package
  artifacts:
    paths:
      - target/*.jar
